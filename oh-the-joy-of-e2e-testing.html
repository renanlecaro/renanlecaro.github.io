<!DOCTYPE html><html lang="en-gb"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Oh, the joy of Meteor e2e testing ! - Renan LE CARO</title><meta name="description" content="I'm setting up e2e testing on my Meteor app, ciboulette.net. I had done it in the past but after large UI changes i just removed the tests as they were completely stale and generally painful to work with : I'm trying again, this time using&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://lecaro.me/oh-the-joy-of-e2e-testing.html"><link rel="alternate" type="application/atom+xml" href="https://lecaro.me/feed.xml"><link rel="alternate" type="application/json" href="https://lecaro.me/feed.json"><meta property="og:title" content="Oh, the joy of Meteor e2e testing !"><meta property="og:site_name" content="Renan LE CARO"><meta property="og:description" content="I'm setting up e2e testing on my Meteor app, ciboulette.net. I had done it in the past but after large UI changes i just removed the tests as they were completely stale and generally painful to work with : I'm trying again, this time using&hellip;"><meta property="og:url" content="https://lecaro.me/oh-the-joy-of-e2e-testing.html"><meta property="og:type" content="article"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@RenanLeCaro"><meta name="twitter:title" content="Oh, the joy of Meteor e2e testing !"><meta name="twitter:description" content="I'm setting up e2e testing on my Meteor app, ciboulette.net. I had done it in the past but after large UI changes i just removed the tests as they were completely stale and generally painful to work with : I'm trying again, this time using&hellip;"><link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin><style>:root {
              --body-font: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
              --heading-font: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
              --logo-font: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
              --menu-font: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
           }</style><link rel="stylesheet" href="https://lecaro.me/assets/css/main.css?v=adf9c646ca416aff97afd632c9133472"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://lecaro.me/oh-the-joy-of-e2e-testing.html"},"headline":"Oh, the joy of Meteor e2e testing !","datePublished":"2021-03-23T15:35","dateModified":"2021-03-23T15:54","description":"I'm setting up e2e testing on my Meteor app, ciboulette.net. I had done it in the past but after large UI changes i just removed the tests as they were completely stale and generally painful to work with : I'm trying again, this time using&hellip;","author":{"@type":"Person","name":"Renan LE CARO"},"publisher":{"@type":"Organization","name":"Renan LE CARO"}}</script><style>.hero {
    height: auto;
    margin-top: 200px;
  }
.hero__content {
    position: initial;
    transform: none;
}</style></head><body><div class="site-container"><header class="top" id="js-header"><a class="logo" href="https://lecaro.me/">Renan LE CARO</a><nav class="navbar js-navbar"><ul class="navbar__menu"><li><a href="https://lecaro.me/hi-im-renan.html" target="_self">About</a></li><li><a href="https://lecaro.me/" target="_self">Posts</a></li></ul></nav></header><main><article class="post"><div class="hero"><header class="hero__content"><div class="wrapper"><div class="post__meta"><time datetime="2021-03-23T15:35">March 23, 2021</time></div><h1>Oh, the joy of Meteor e2e testing !</h1></div></header></div><div class="wrapper post__entry"><p>I'm setting up e2e testing on my Meteor app, ciboulette.net.</p><p><span style="color: var(--text-editor-body-color); font-family: var(--font-base); font-size: inherit; font-weight: var(--font-weight-normal);">I had done it in the past but after large UI changes i just removed the tests as they were completely stale and generally painful to work with : </span></p><ul><li>they were <strong>brittle and/or slow</strong></li><li>they were a <strong>pain to edit</strong>. </li><li>they didn't run in <strong>CI</strong></li></ul><p><span style="color: var(--text-editor-body-color); font-family: var(--font-base); font-size: inherit; font-weight: var(--font-weight-normal);">I'm trying again, this time using <strong>playwright.</strong></span></p><p>To <strong>make the tests less brittle</strong>, i <span style="color: var(--text-editor-body-color); font-family: var(--font-base); font-size: inherit; font-weight: var(--font-weight-normal);">had to disable some of the "smarts" of the app to make the tests work at high speed  :</span></p><ul><li><span style="color: var(--text-editor-body-color); font-family: var(--font-base); font-size: inherit; font-weight: var(--font-weight-normal);">Instead of deferring heavy workloads, I run them synchronously before returning from a method.</span></li><li><span style="color: var(--text-editor-body-color); font-family: var(--font-base); font-size: inherit; font-weight: var(--font-weight-normal);">My modal windows wait for the method result to come back from the server (no optimistic UI magic)</span></li><li><span style="color: var(--text-editor-body-color); font-family: var(--font-base); font-size: inherit; font-weight: var(--font-weight-normal);">I had some logic to ignore double clicks that I had to disable in e2e mode</span></li><li>I completely mocked external services (google maps, google image, emails, sms, etc..)</li></ul><p>To <strong>make editing easier</strong>, I had to fix a few things :</p><ul><li>I start the e2e server with a different meteor local file, on a different port, with dedicated settings</li><li><span style="color: var(--text-editor-body-color); font-family: var(--font-base); font-size: inherit; font-weight: var(--font-weight-normal);">I don't use the headful mode because it always start in the wrong place.</span></li><li>I take screenshots at every step, outputting the screenshot to one file that refreshes automatically when viewed with eog (eye of gnome) </li><li>I use nodemon to restart the tests when i change them (but not when I change any other file) </li><li>I start both my headless tests and eog with <strong><strong>npm-run-all</strong></strong></li></ul><p>Running the tests in <strong>github ci</strong></p><ul><li>The CI scrip uses <strong>start-server-and-test</strong> to start the meteor server in e2e mode and run the headless tests against it</li><li>The e2e Ci script runs<strong> npm install</strong>, but all other scripts run <strong>npm install --production</strong>. Playwright is heavy and is not required to build the app so i've added it as a devDependency. The unit tests are lightweight so i've added jest as a normal dependency.</li></ul><p>The <strong>remaining challenge</strong> I have is to create snapshots at different stages of the test (page url, db content, cookies) so that i can skip most of the e2e tests suite when editing a small part of it. It's tricky, involves hardcoded mongo urls, some mongorestore and mongodump run with execSync .. and not working yet. </p><p> </p><p>Extract of my package.json scripts :</p><pre>"e2e:server": "METEOR_LOCAL_DIR=.meteor/e2e  meteor --port 4000 --settings settings.e2e.json",<br>"e2e:cli:showImages": "eog tests/e2e/last-test-state.png",<br>"e2e:cli:nodemon": "SNAPALL=true nodemon  --watch tests/e2e/01_signup.js tests/e2e/01_signup.js",<br>"e2e:cli": "run-p e2e:cli:* ",<br>"e2e:ci:node": "node tests/e2e/01_signup.js ",<br>"e2e:ci": "start-server-and-test e2e:server http://localhost:4000 e2e:ci:node"</pre></div></article></main><footer class="footer"><div class="footer__copyright"><p>+33 6 28 35 01 14 (Whatsapp only)</p><p><a href="mailto:renan.lecaro@gmail.com">renan.lecaro@gmail.com</a></p></div></footer></div><script async defer="defer" data-domain="lecaro.me" src="https://stats.lecaro.me/js/index.js"></script></body></html>