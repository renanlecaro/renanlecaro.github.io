<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <title>Renan LE CARO</title>
    <link href="https://lecaro.me/feed.xml" rel="self" />
    <link href="https://lecaro.me" />
    <updated>2021-03-25T10:21:45+01:00</updated>
    <author>
        <name>Renan LE CARO</name>
    </author>
    <id>https://lecaro.me</id>

    <entry>
        <title>Basic i3blocks controls for ubuntu rhythmbox</title>
        <author>
            <name>Renan LE CARO</name>
        </author>
        <link href="https://lecaro.me/basic-i3blocks-controls-for-ubuntu-rhythmbox.html"/>
        <id>https://lecaro.me/basic-i3blocks-controls-for-ubuntu-rhythmbox.html</id>

        <updated>2021-03-25T10:21:45+01:00</updated>
            <summary>
                <![CDATA[
                    I've switched over from Spotify to Rhythmbox today. Spotify was a bit unstable on my system, it sometimes even struggled to playback offline playlists. I'm back to the good old "music" folder with files of long forgotten origins. The default ubuntu music player, rhythmbox, seems&hellip;
                ]]>
            </summary>
        <content type="html">
            <![CDATA[
                <p>I've switched over from Spotify to Rhythmbox today. Spotify was a bit unstable on my system, it sometimes even struggled to playback offline playlists.</p>
<p>I'm back to the good old "music" folder with files of long forgotten origins.  </p>
<p>The default ubuntu music player, rhythmbox,  seems not too bad, i don't need it to do much anyway. </p>
<p>I just had to port my i3 bar script to : </p>
<ul>
<li>show the track currently playing</li>
<li>go to next track on right click</li>
<li>play/pause on left click<br><br></li>
</ul>
<p> </p>
<figure class="post__image align-center"><img loading="lazy"  src="https://lecaro.me/media/posts/17/i3script" alt="" width="478" height="53"></figure>
<p>The look of the "widget", pretty basic. </p>
<p>I wanted to add a play/pause icon but </p>
<ul>
<li>i didn't find a way to ask rhythmbox-client if the  music is played or paused</li>
<li>my ears are usually enough to know if anything i s playing </li>
</ul>
<p>I also added a little regexp to remove anything in parenthesis in the track name, to remove "(Original mix)" mentions and such. </p>
<p>.config/i3/i3blocks.conf :</p>
<pre>[music]<br>command=node ~/.config/i3/rhythmbox.js $button<br>interval=5</pre>
<p><span style="color: var(--text-editor-body-color); font-family: var(--font-base); font-size: inherit; font-weight: var(--font-weight-normal);">The actual node script (I suck at bash, that's why i'm using node for this)</span></p>
<p><span style="color: var(--text-editor-body-color); font-family: var(--font-base); font-size: inherit; font-weight: var(--font-weight-normal);">~/.config/i3/rhythmbox.js</span></p>
<pre><br>const {execSync}=require('child_process')<br><br>// apply click actions<br>switch(process.env.BLOCK_BUTTON){<br>  case  '1': execSync('rhythmbox-client --play-pause');<br>    break; <br>  case  '3': execSync('rhythmbox-client --next');<br>    break;<br>}<br><br>// get track name<br>const playing=(execSync('rhythmbox-client --print-playing').toString())||'';<br><br>// clean track name<br>const formatted=playing.replace(/\([^\)]+\)/gi,'')<br><br>// output it<br>console.log(formatted);</pre>
            ]]>
        </content>
    </entry>
    <entry>
        <title>3 video games I&#x27;ve spent 100+ hours on</title>
        <author>
            <name>Renan LE CARO</name>
        </author>
        <link href="https://lecaro.me/3-video-games-ive-spend-100-hours-on.html"/>
        <id>https://lecaro.me/3-video-games-ive-spend-100-hours-on.html</id>

        <updated>2021-03-25T10:06:17+01:00</updated>
            <summary>
                <![CDATA[
                    I don't really play much those days, but I've had some great gaming experiences I felt like sharing today. This strategy game is free, ad free, and has an amazing replay-ability thanks to the user generated levels. It's easy to learn, and not too hard&hellip;
                ]]>
            </summary>
        <content type="html">
            <![CDATA[
                <p>I don't really play much those days, but I've had some great gaming experiences I felt like sharing today.</p>
<table style="border-collapse: collapse; width: 100%;" border="0">
<tbody>
<tr>
<td style="width: 50%;"><figure class="post__image align-center"><img loading="lazy"  src="https://lecaro.me/media/posts/16/antiyoy.png" sizes="(max-width: 48em) 100vw, 768px" srcset="https://lecaro.me/media/posts/16/responsive/antiyoy-xs.png 300w ,https://lecaro.me/media/posts/16/responsive/antiyoy-sm.png 480w ,https://lecaro.me/media/posts/16/responsive/antiyoy-md.png 768w ,https://lecaro.me/media/posts/16/responsive/antiyoy-lg.png 1024w ,https://lecaro.me/media/posts/16/responsive/antiyoy-xl.png 1360w ,https://lecaro.me/media/posts/16/responsive/antiyoy-2xl.png 1600w"  alt="" width="240" height="400"></figure></td>
<td style="width: 50%;">
<h2>Antiyoy - Android</h2>
<p> This <strong>strategy</strong> game is free, ad free, and has an amazing replay-ability thanks to the user generated levels.  </p>
<p>It's <strong>easy to learn</strong>, and not too hard to master, after a while most levels are trivial. </p>
<p>Some get tough though, and I had to look at the solutions from random Russian Youtube videos at times. </p>
</td>
</tr>
<tr>
<td style="width: 50%;"><figure class="n3VNCb"><img loading="lazy"  src="https://i.ytimg.com/vi/J8SBp4SyvLc/maxresdefault.jpg" data-is-external-image="true"  alt="Factorio - Trailer 2020 - YouTube" data-noaft="1"></figure></td>
<td style="width: 50%;">
<h2>Factorio - Linux</h2>
<p>It's one of those game that's programmer's heaven. Or hell. It's very similar to <strong>programming</strong> (design, debugging, automating, constantly learning) <strong>but with guns</strong>.</p>
</td>
</tr>
<tr>
<td style="width: 50%;"><figure class="n3VNCb"><img loading="lazy"  src="https://upload.wikimedia.org/wikipedia/commons/thumb/e/ef/Nuclear_Throne_screenshot_10.png/1200px-Nuclear_Throne_screenshot_10.png" data-is-external-image="true"  alt="Nuclear Throne — Wikipédia" data-noaft="1"></figure></td>
<td style="width: 50%;">
<h2>Nuclear throne - Linux</h2>
<p>This is one of the <strong>roguelikes</strong> I sicked to, and after a while i got pretty good at it. <strong>Runs are short</strong>, so it's perfect to spend a few minutes before starting a complicated topic. It's frustrating enough that you don't end up playing 2 hours without realising it.  </p>
</td>
</tr>
</tbody>
</table>
<p> </p>
            ]]>
        </content>
    </entry>
    <entry>
        <title>Javascript minification with sed</title>
        <author>
            <name>Renan LE CARO</name>
        </author>
        <link href="https://lecaro.me/javascript-minification-with-sed.html"/>
        <id>https://lecaro.me/javascript-minification-with-sed.html</id>

        <updated>2021-03-24T22:41:32+01:00</updated>
            <summary>
                <![CDATA[
                    I added a few of my projects to those "Pages under 1MB" websites. I'm not sure what for, but eh, it's free link estate ! Anyway, while most of those lists are comprised of boring, barely formatted text pages, i stumbled upon a nice one,&hellip;
                ]]>
            </summary>
        <content type="html">
            <![CDATA[
                <p>I added a few of my projects to those "<a href="https://1mb.club/">Pages under 1MB</a>" websites. I'm not sure what for, but eh, it's free link estate !</p>
<p>Anyway, while most of those lists are comprised of <a href="https://jakob.kaivo.net/">boring</a>, barely formatted text pages,  i stumbled upon a nice one, this <a href="https://tutor.0b.ee/">touch type trainer</a> in 2 KB of js. The best thing about it  is not really the tool (it's limited, obviously) but the absurd way the author got down to that 2kb size, in particular this little gem. </p>
<p><a href="https://github.com/KaarelP2rtel/keyboard-tutor/blob/master/minify.sh">minify.sh</a> </p>
<pre>sed -i 's/tutor-window/tw/g' "$target"<br>sed -i 's/tutor-container/tc/g' "$target"<br>sed -i 's/tutor-completed/tm/g' "$target"<br>sed -i 's/tutor-cursor/tr/g' "$target"<br>sed -i 's/tutor-uncompleted/tu/g' "$target"<br>sed -i 's/tutor-result/te/g' "$target"<br>sed -i 's/tutor-status/ts/g' "$target"<br>sed -i 's/current-layout/cl/g' "$target"</pre>
<p>I have no words, it's beautiful :) </p>
<p>I remember going to similar extremes on <a href="https://github.com/renanlecaro/importabular/blob/master/src/index.js#L50">importabular</a>. </p>
<p>All the private methods had names prefixed by an underscore, and then i had some instructions for the minifying tool to not keep names with that prefix. </p>
<p>It shaved a few kilobytes from the already tiny lib, but i reverted it after to make it easier to subclass the Importabular class. </p>
<p> That period with the lower bars on <a href="https://bundlephobia.com/result?p=importabular@0.2.9">bundlephobia</a> is where this behavior was installed</p>
<p>Anyway, gzipped code golf is always a lot of fun. </p>
<p> </p>
            ]]>
        </content>
    </entry>
    <entry>
        <title> Be careful what you ping for</title>
        <author>
            <name>Renan LE CARO</name>
        </author>
        <link href="https://lecaro.me/be-careful-what-you-ping-for.html"/>
        <id>https://lecaro.me/be-careful-what-you-ping-for.html</id>

        <updated>2021-03-24T15:49:39+01:00</updated>
            <summary>
                <![CDATA[
                    I have a setup to know when my main app, ciboulette.net, is down. It's based on statuscake, which pings my marketing site every 5 minutes, and also my main app. It used to ping a third endpoint, which was an order form deep inside my&hellip;
                ]]>
            </summary>
        <content type="html">
            <![CDATA[
                <p>I have a setup to know when my main app, ciboulette.net, is down.</p>
<p>It's based on <a href="https://www.statuscake.com/">statuscake</a>, which pings my marketing site every 5 minutes, and also my main app. </p>
<figure class="post__image"><img loading="lazy"  src="https://lecaro.me/media/posts/14/Screenshot-from-2021-03-24-15-23-56.png" sizes="(max-width: 48em) 100vw, 768px" srcset="https://lecaro.me/media/posts/14/responsive/Screenshot-from-2021-03-24-15-23-56-xs.png 300w ,https://lecaro.me/media/posts/14/responsive/Screenshot-from-2021-03-24-15-23-56-sm.png 480w ,https://lecaro.me/media/posts/14/responsive/Screenshot-from-2021-03-24-15-23-56-md.png 768w ,https://lecaro.me/media/posts/14/responsive/Screenshot-from-2021-03-24-15-23-56-lg.png 1024w ,https://lecaro.me/media/posts/14/responsive/Screenshot-from-2021-03-24-15-23-56-xl.png 1360w ,https://lecaro.me/media/posts/14/responsive/Screenshot-from-2021-03-24-15-23-56-2xl.png 1600w"  alt="Screenshot of statuscake" width="649" height="271"></figure>
<p>It used to ping a third endpoint, which was an order form deep inside my app. </p>
<p>The idea was to check the the clients of my clients should be able to order veggies, so pinging a specific, real page would make sense.</p>
<p>I also used to log every action that would happen on such an order, directly in an array within the "order" document.</p>
<p>It means that every 5 minute, the document was getting a tiny bit bigger. </p>
<p>Today, i tried to mongorestore a production dump on my local dev environment to get fresh data. It's very useful to see how the real data would look like in the new version, and lets me see missuses and bugs that i would miss otherwise. </p>
<p>So i tried to import my production dump (the db needs renaming from "ciboulette" to "meteor" to work locally) </p>
<pre>renan@renan-hp:~/cl/app$ cat dump/daily_21-03-24.backup.gzip | mongorestore --archive --gzip  --nsFrom='ciboulette.*' --nsTo='meteor.*' --uri=mongodb://127.0.0.1:3001/<br>2021-03-24T15:31:06.076+0100 preparing collections to restore from<br>2021-03-24T15:31:06.083+0100 reading metadata for meteor.shortUrls from archive on stdin<br>2021-03-24T15:31:06.102+0100 restoring meteor.shortUrls from archive on stdin<br>2021-03-24T15:31:06.263+0100 reading metadata for meteor.opens from archive on stdin<br>2021-03-24T15:31:06.278+0100 restoring meteor.opens from archive on stdin<br>2021-03-24T15:31:06.753+0100 reading metadata for meteor.Orders from archive on stdin<br>2021-03-24T15:31:06.767+0100 restoring meteor.Orders from archive on stdin<br>2021-03-24T15:31:07.308+0100 reading metadata for meteor.logs from archive on stdin<br>2021-03-24T15:31:07.318+0100 restoring meteor.logs from archive on stdin<br>2021-03-24T15:31:07.827+0100 no indexes to restore<br>2021-03-24T15:31:07.827+0100 finished restoring meteor.shortUrls (8224 documents, 0 failures)<br>2021-03-24T15:31:08.269+0100 no indexes to restore<br>2021-03-24T15:31:08.269+0100 finished restoring meteor.opens (21263 documents, 0 failures)<br>2021-03-24T15:31:08.503+0100 finished restoring meteor.Orders (32999 documents, 1 failure)<br>2021-03-24T15:31:08.503+0100 Failed: <strong>meteor.Orders: error restoring from archive</strong> on stdin: bulk write error: [{[{<strong>write to oplog failed: BadValue: object to insert exceeds cappedMaxSize</strong>}]}, {&lt;nil&gt;}]<br>2021-03-24T15:31:08.503+0100 32999 document(s) restored successfully. 1 document(s) failed to restore.</pre>
<p>It took me quite a while to pinpoint the problem. </p>
<p>Luckily, the same dump would import fine in a real mongod instance, the problem seemed to be only with the meteor provided development mongo instance. </p>
<p>The problem seemed to be be with some order documents. </p>
<p>So, first i wiped the local "meteor" db in mongod</p>
<pre>mongo mongodb://127.0.0.1:27017/meteor --eval "db.dropDatabase()"</pre>
<p>Then i imported the dump there</p>
<pre>cat dump/daily_21-03-24.backup.gzip | mongorestore --archive --gzip  --nsFrom='ciboulette.*' --nsTo='meteor.*'</pre>
<p>I tried removing all documents from db.Orders, dumping, and then importing that to meteor, it worked. But i was missing my main collection.</p>
<p>I then used this script to find the biggest document and its _id within my mongo collection</p>
<pre> mongo  mongodb://127.0.0.1:27017/meteor --eval "(()=&gt;{var max=0,maxId=null; <strong>db.Orders</strong>.find().forEach(o=&gt;{var s=<strong>Object.bsonsize</strong>(o);if(s&gt;max){max=s;maxId=o._id}}); return {max,maxId}})()"<br><br>MongoDB server version: 4.4.4<br>{ <strong>"max" : 14199831</strong>, "maxId" : "GBeerkZ46dcjAgLtu" }</pre>
<p>14 199 831 bytes, holly molly ! About 14 megabytes of text in one document.</p>
<p>A findOne query allowed me to see that it was the "Order.logs" field that was so full.</p>
<p>So i cleaned up this field in  all documents :</p>
<pre>renan@renan-hp:~/cl/app$ mongo mongodb://127.0.0.1:27017/meteor --eval 'db.Orders.update({logs:{ $exists:true}},<strong>{$unset:{logs:""}},{multi:true}</strong>);'<br>MongoDB shell version v4.4.4<br>connecting to: mongodb://127.0.0.1:27017/meteor?compressors=disabled&amp;gssapiServiceName=mongodb<br>Implicit session: session { "id" : UUID("bb02fe49-5241-4beb-82ea-fbdc4c325998") }<br>MongoDB server version: 4.4.4<br>WriteResult({ "nMatched" : 180383, "nUpserted" : 0, <strong>"nModified" : 180383</strong> })</pre>
<p> And re-run the maximum size check </p>
<pre>mongo mongodb://127.0.0.1:27017/meteor --eval "(()=&gt;{var max=0,maxId=null; db.Orders.find().forEach(o=&gt;{var s=Object.bsonsize(o);if(s&gt;max){max=s;maxId=o._id}}); return {max,maxId}})()"<br>{ "max" : <strong>7578</strong>, "maxId" : "eYdGxbBKDNfKZYZw8" }</pre>
<p>Much, much better :)</p>
<p>So, all that was left was to dump that data, load the dump in meteor and all was fine.</p>
<p>I added a migration to clean that field in production too.  It will run on the next deploy. </p>
<p> </p>
            ]]>
        </content>
    </entry>
    <entry>
        <title>Oh, the joy of Meteor e2e testing !</title>
        <author>
            <name>Renan LE CARO</name>
        </author>
        <link href="https://lecaro.me/oh-the-joy-of-e2e-testing.html"/>
        <id>https://lecaro.me/oh-the-joy-of-e2e-testing.html</id>
            <category term="Blog post"/>

        <updated>2021-03-23T14:54:14+01:00</updated>
            <summary>
                <![CDATA[
                    I'm setting up e2e testing on my Meteor app, ciboulette.net. I had done it in the past but after large UI changes i just removed the tests as they were completely stale and generally painful to work with : I'm trying again, this time using&hellip;
                ]]>
            </summary>
        <content type="html">
            <![CDATA[
                <p>I'm setting up e2e testing on my Meteor app, ciboulette.net.</p>
<p><span style="color: var(--text-editor-body-color); font-family: var(--font-base); font-size: inherit; font-weight: var(--font-weight-normal);">I had done it in the past but after large UI changes i just removed the tests as they were completely stale and generally painful to work with : </span></p>
<ul>
<li>they were <strong>brittle and/or slow</strong></li>
<li>they were a <strong>pain to edit</strong>. </li>
<li>they didn't run in <strong>CI</strong></li>
</ul>
<p><span style="color: var(--text-editor-body-color); font-family: var(--font-base); font-size: inherit; font-weight: var(--font-weight-normal);">I'm trying again, this time using <strong>playwright.</strong></span></p>
<p>To <strong>make the tests less brittle</strong>, i <span style="color: var(--text-editor-body-color); font-family: var(--font-base); font-size: inherit; font-weight: var(--font-weight-normal);">had to disable some of the "smarts" of the app to make the tests work at high speed  : </span></p>
<ul>
<li><span style="color: var(--text-editor-body-color); font-family: var(--font-base); font-size: inherit; font-weight: var(--font-weight-normal);">Instead of deferring heavy workloads, I run them synchronously before returning from a method.</span></li>
<li><span style="color: var(--text-editor-body-color); font-family: var(--font-base); font-size: inherit; font-weight: var(--font-weight-normal);">My modal windows wait for the method result to come back from the server (no optimistic UI magic)</span></li>
<li><span style="color: var(--text-editor-body-color); font-family: var(--font-base); font-size: inherit; font-weight: var(--font-weight-normal);">I had some logic to ignore double clicks that I had to disable in e2e mode</span></li>
<li>I completely mocked external services (google maps, google image, emails, sms, etc..)</li>
</ul>
<p>To <strong>make editing easier</strong>, I had to fix a few things :</p>
<ul>
<li>I start the e2e server with a different meteor local file, on a different port, with dedicated settings</li>
<li><span style="color: var(--text-editor-body-color); font-family: var(--font-base); font-size: inherit; font-weight: var(--font-weight-normal);">I don't use the headful mode because it always start in the wrong place.</span></li>
<li>I take screenshots at every step, outputting the screenshot to one file that refreshes automatically when viewed with eog (eye of gnome) </li>
<li>I use nodemon to restart the tests when i change them (but not when I change any other file) </li>
<li>I start both my headless tests and eog with <strong><strong>npm-run-all</strong></strong></li>
</ul>
<p>Running the tests in <strong>github ci</strong></p>
<ul>
<li>The CI scrip uses <strong>start-server-and-test</strong> to start the meteor server in e2e mode and run the headless tests against it</li>
<li>The e2e Ci script runs<strong> npm install</strong>, but all other scripts run <strong>npm install --production</strong>. Playwright is heavy and is not required to build the app so i've added it as a devDependency. The unit tests are lightweight so i've added jest as a normal dependency.</li>
</ul>
<p>The <strong>remaining challenge</strong> I have is to create snapshots at different stages of the test (page url, db content, cookies) so that i can skip most of the e2e tests suite when editing a small part of it. It's tricky, involves hardcoded mongo urls, some mongorestore and mongodump run with execSync .. and not working yet. </p>
<p> </p>
<p>Extract of my package.json scripts :</p>
<pre>"e2e:server": "METEOR_LOCAL_DIR=.meteor/e2e  meteor --port 4000 --settings settings.e2e.json",<br>"e2e:cli:showImages": "eog tests/e2e/last-test-state.png",<br>"e2e:cli:nodemon": "SNAPALL=true nodemon  --watch tests/e2e/01_signup.js tests/e2e/01_signup.js",<br>"e2e:cli": "run-p e2e:cli:* ",<br>"e2e:ci:node": "node tests/e2e/01_signup.js ",<br>"e2e:ci": "start-server-and-test e2e:server http://localhost:4000 e2e:ci:node"</pre>
            ]]>
        </content>
    </entry>
    <entry>
        <title>My 3 favorite playlists : house, trance and funk</title>
        <author>
            <name>Renan LE CARO</name>
        </author>
        <link href="https://lecaro.me/my-3-favorite-playlists.html"/>
        <id>https://lecaro.me/my-3-favorite-playlists.html</id>
            <category term="Blog post"/>

        <updated>2021-03-23T14:54:09+01:00</updated>
            <summary>
                <![CDATA[
                    I have 3 playlists on Spotify I always come back to , thought i'd share them here Deep house as a background music for lightweight tasks, and as a loud playlist for festive events. Psychedelic trance when I need a motivation surge for a tough&hellip;
                ]]>
            </summary>
        <content type="html">
            <![CDATA[
                <p>I have 3 playlists on Spotify I always come back to , thought i'd share them here</p>
<ul>
<li><a href="https://open.spotify.com/playlist/4U1xZfxO1AsNbqWYKbfUnM?si=dTcARomPSLqMRaNHPvoWRw">Deep house</a> as a background music for lightweight tasks, and as a loud playlist for festive events.</li>
<li><a href="https://open.spotify.com/playlist/69gyd1SXiVhvfsyYS078f0?si=MnvGO1LTRhOy11neMwBHaQ">Psychedelic trance</a> when I need a motivation surge for a tough bit of code. It can get tiring after a few hours</li>
<li><a href="https://open.spotify.com/playlist/2BAkAh0GWqDwuSFEJsH1wJ?si=2y98meZORqaFBCfni2iwng">Low volume funk</a> for events which involve people I don't know the music taste of, and music is not the focus of  the event. It's selected so that the tracks don't overpower the soundscape and sound good even at a low volume. </li>
</ul>
            ]]>
        </content>
    </entry>
    <entry>
        <title>Customizing the look of Publii</title>
        <author>
            <name>Renan LE CARO</name>
        </author>
        <link href="https://lecaro.me/customizing-the-look-of-publii.html"/>
        <id>https://lecaro.me/customizing-the-look-of-publii.html</id>
            <category term="Blog post"/>

        <updated>2021-03-23T14:17:46+01:00</updated>
            <summary>
                <![CDATA[
                    I really like the look of the default Publii theme, however some modifications weren't quite working using the in-app options. I wanted this website to have a very low level of interactivity, i don't need a mobile hamburger menu for 2 short entries (code &amp;&hellip;
                ]]>
            </summary>
        <content type="html">
            <![CDATA[
                <p>I really like the look of the default Publii theme, however some modifications weren't quite working using the in-app options. I wanted this website to have a very low level of interactivity, i don't need a mobile hamburger menu for 2 short entries (code &amp; life). </p>
<p>So I started looking for a different theme but I couldn't find what I was looking for, that is, a minimalist theme. I resolved to just strip things away from the default theme to make it lighter and JS free. </p>
<p>Opening the default theme gave me the same feeling that I got when trying to customize the code of a 40$ admin panel. Lots of code, neatly organized, most of it unused.</p>
<blockquote>
<p>What is all this code, what is it for ? Oh, i can get rid of it.  </p>
</blockquote>
<p>I managed to strip down the source by removing the parts I wasn't interested in. I think now the design looks clean, and I got rid of most useless css and js I could find. I'm not sure that this is the right approach, as those changes definitely won't survive a theme update (but why would I want to update it ?) and are a bit hacky. I'm pretty sure those changes are only stored on my machine, so if I try to edit the website from somewhere else it will revert back to it's default look. </p>
<p>However, i'm not too worried about this. This personal website is a playground for experimentation after all.</p>
            ]]>
        </content>
    </entry>
    <entry>
        <title>Life in Владивосток</title>
        <author>
            <name>Renan LE CARO</name>
        </author>
        <link href="https://lecaro.me/life-in-vladivostok.html"/>
        <id>https://lecaro.me/life-in-vladivostok.html</id>
            <category term="Blog post"/>

        <updated>2021-03-23T14:17:52+01:00</updated>
            <summary>
                <![CDATA[
                    I've been living in Vladivostok, Russia, since the end of February 2020. I'm a student here, learning the Russian language. I'm a bit older than the average student but my life is still very student-like anyway. I really enjoy the energy of younger friends and&hellip;
                ]]>
            </summary>
        <content type="html">
            <![CDATA[
                <p>I've been living in Vladivostok, Russia, since the end of February 2020. </p>
<p>I'm a student here, learning the Russian language. I'm a bit older than the average student but my life is still very student-like anyway. I really enjoy the energy of younger friends and the large amount of free time we have.</p>
<h2>Life is cheap </h2>
<p>I'm renting a room on the DVFU campus, it costs barely 40€/month, but it's only possible to rent it as a student, the study itself costing around 140€/month. As a student, I can benefit from the very cheap student health insurance that costs about 50€/year. </p>
<p>Overall, I'm spending less than 500€/month here to live quite comfortably. I'm happy to have found this opportunity. </p>
<h2>Life is good</h2>
<p>The Russian class starts at 10am every day. It lasts 2 hours, and is currently happening via Skype. That means I don't have to spend 3 hours in transport every day. When the confinement will be over though, we'll have to go back to physical classes, that happen in the city. Traffic is usually quite bad in the morning, and the trip without traffic from the FEFU campus to the city is about 1 hour without traffic, so it's not unusual to have to spend one hour thirty in transports to go to class. I really hope we'll have the option to keep our classes online, I find it way more convenient. </p>
<p>We live near the sea and near nature, it's great. We've done countless barbecues, trekking trips and swimming sessions. </p>
<p>The only scholarly thing I'm required to do to keep my student status is to be present in class. Doing the homework is recommended, but kind of optional. I don't do them anymore so that I can focus all my energy on the programming of <a href="https://ciboulette.net">ciboulette.net</a>  </p>
<h2>This too, shall pass</h2>
<p>I won't stay eternally here, my motivation to learn Russian is lower than when I arrived, and my fascination for the country is now back to simple curiosity. </p>
<p>I'll head back to Europe in December, to focus on the sales process of ciboulette. I'm thinking about moving to France first, to help my sister for a while with her setup in a new house. I'll do calling and development work when I have free time, and keep an eye on my niece at the same time. </p>
<p>Then, my currently favored plan is to set myself up in Odessa, Ukraine, to enjoy the good weather, Russian speaking opportunities and affordable cost of living. French citizen get 6 months visa free there, which should be enough for me to know if I want to stay here longer or not. </p>
<p> </p>
<p>  </p>
            ]]>
        </content>
    </entry>
    <entry>
        <title>Automating local backups of DO MUP on Ubuntu</title>
        <author>
            <name>Renan LE CARO</name>
        </author>
        <link href="https://lecaro.me/automating-backups-of-digital-ocean-meteor-up-install-to-your-ubuntu-workstation.html"/>
        <id>https://lecaro.me/automating-backups-of-digital-ocean-meteor-up-install-to-your-ubuntu-workstation.html</id>
            <category term="Blog post"/>

        <updated>2021-03-23T14:17:58+01:00</updated>
            <summary>
                <![CDATA[
                    DO + MUP = 💙 I've migrated my main project, https://ciboulette.net, from Heroku to digital ocean, with the help of the awesome meteor up tool that's still actively maintained. I wanted a way to automate the backups of production to my own computer. In meteor,&hellip;
                ]]>
            </summary>
        <content type="html">
            <![CDATA[
                <h2>DO + MUP = 💙</h2>
<p>I've migrated my main project, <a href="https://www.digitalocean.com/">https://ciboulette.net</a>, from Heroku to <a href="https://www.digitalocean.com/">digital ocean</a>, with the help of the awesome <a href="https://meteor-up.com/">meteor up</a> tool that's still actively maintained.</p>
<p>I wanted a way to automate the backups of production to my own computer. In meteor, the only thing really worth backing up is the content of the mongoDB.</p>
<p><strong>We need two things : a script</strong> that does the backup, <strong>and a cron job</strong> to run regularly</p>
<h2>Backup script</h2>
<p>You just need to configure the two environment variables at the top (in bold)</p>
<p><strong>daily_backup.sh</strong></p>
<pre>#!/bin/sh<br><br># folder where to store the last 7 daily backups, without trailing slash<br>DUMPFOLDER="<strong>/home/renan/cl/app/dump</strong>"<br><br># IP of your digital ocean droplet<br>DO_INSTANCE_IP="<strong>46.101.232.182</strong>"<br><br># so that notifications know on which display to show when called from the cron tab<br>export DISPLAY=:0<br><br># Let it quit when it crash<br>set -e<br><br>DUMPFILE="$DUMPFOLDER/daily_$(date +"%y-%m-%d").backup.gzip"<br><br>if [ ! -f $DUMPFILE ];<br>then<br>  continue<br>else<br>  echo "Already done today" &amp;&amp; exit 0<br>fi<br><br>notify-send "Backing up ..."<br><br># ssh to the instance, then ask the mongodb container to output an archive of all dbs, then stream that back to your machine. <br>ssh "root@$DO_INSTANCE_IP" "docker exec mongodb mongodump --archive --gzip" &gt; "${DUMPFILE}"<br><br># Only keep the last 7 dumps <br>ls -tp $DUMPFOLDER/ | grep -v '/$' | tail -n +8 | xargs -I {} rm -- $DUMPFOLDER/{}<br><br>notify-send "... backup done."</pre>
<p>Make sure the script is executable with <code>chmod +x daily_backup.sh</code></p>
<h2>CRON setup</h2>
<p>We will run this script every hour. The first time it runs it will do the backup, and the next time it will see the file exists already and just exit. The next day the filename will be different and therefore a new backup will be run. </p>
<p>Open the cron editor : <code>crontab -e</code> </p>
<p>Add the following line, modifying the path in bold to point to your script.  </p>
<p><code>1 * * * * /<strong>home/renan/cl/app/.production/daily_backup.sh</strong> &gt;/dev/null 2&gt;&amp;1</code></p>
<p>This will run the script every hour when minutes are equal to 1, so if you start your computer at 8:30 it will first run at 9:01</p>
<p>The redirect after the command are to avoid having errors show up in the logs. Ubuntu is a bit confused when cron jobs generate outputs.  </p>
<h2>How to restore such backup</h2>
<p>Having backup is nice, but knowing out to restore them is better. </p>
<pre>#!/bin/sh<br><br># folder with the dumps<br>DUMPFOLDER="<strong>/home/renan/cl/app/dump</strong>"<br># IP of your digital ocean droplet<br>DO_INSTANCE_IP="<strong>46.101.232.182</strong>"<br><br># Let it quit when it crash<br>set -e<br><br># find the latest backup file<br>LATEST_FILE=$(ls -t1 "$DUMPFOLDER/" |  head -n 1)<br>LATEST_DUMP="$DUMPFOLDER/$LATEST_FILE"<br>echo "Restoring to production from $LATEST_DUMP"<br>read -p "Press enter to continue .."<br><br># pipe file to the mongorestore inside the mongodb docker container inside the droplet <br>cat "${LATEST_DUMP}" | ssh "root@$DO_INSTANCE_IP" "cat | docker exec -i mongodb mongorestore --archive --gzip --drop"</pre>
            ]]>
        </content>
    </entry>
    <entry>
        <title>Mermaid Gdocs</title>
        <author>
            <name>Renan LE CARO</name>
        </author>
        <link href="https://lecaro.me/mermaid-gdocs.html"/>
        <id>https://lecaro.me/mermaid-gdocs.html</id>
            <category term="Blog post"/>

        <updated>2021-03-23T14:18:05+01:00</updated>
            <summary>
                <![CDATA[
                    Working at virtualQ, it happened a few times that I'd start a project with unclear requirements, then presented it to the rest of the team just to see everything needing to be changed or canceled. To avoid such disappointing outcome, I tried to make more&hellip;
                ]]>
            </summary>
        <content type="html">
            <![CDATA[
                <p>Working at virtualQ, it happened a few times that I'd start a project with unclear requirements, then presented it to the rest of the team just to see everything needing to be changed or canceled. </p>
<p>To avoid such disappointing outcome, I tried to make more design docs. A design doc is roughly said a document that will detail all the possible solutions to a problem, and serve as a support for debate, ideas and discussions. After a design doc is accepted by the team, you can go ahead with the development with less risk of requirements being inadequate. </p>
<p>Most features would include some back end and front end elements, and some user flows. Trying to make the documents more readable, I added as many sequence diagrams as possible. Sequence diagrams are excellent at communicating a process. Their layout forces you to be succinct  as there's not much space for walls of texts and unnecessary details.</p>
<p>I first edited the diagrams in the excellent <a href="https://www.websequencediagrams.com/">websequencediagrams.com</a> and pasted a screenshot in the google documents, but that was a bit of a pain to maintain. This tool keeps a copy of the source code, so i'd just need to edit it and update the resulting picture in the google document, but no one else had access to said source code. I thought i could just save the source code in the image description field in google docs, to make it easier to update the diagram for anyone in the team.</p>
<p>This is when I realized i could use this "trick" to create a <a href="https://gsuite.google.com/marketplace/app/mermaid/636321283856?pann=cwsdp&amp;hl=en">google docs add-on</a>. In a classic case of "putting off writing documentation by focusing on the tools used in documenting", I followed the (super confusing) tutorials on the google documentation website for G Suite add-ons. </p>
<figure class="post__image post__image--center" ><img loading="lazy" src="https://lecaro.me/media/posts/8/Screenshot-from-2020-06-05-08-52-21.png" sizes="(max-width: 48em) 100vw, 768px" srcset="https://lecaro.me/media/posts/8/responsive/Screenshot-from-2020-06-05-08-52-21-xs.png 300w ,https://lecaro.me/media/posts/8/responsive/Screenshot-from-2020-06-05-08-52-21-sm.png 480w ,https://lecaro.me/media/posts/8/responsive/Screenshot-from-2020-06-05-08-52-21-md.png 768w ,https://lecaro.me/media/posts/8/responsive/Screenshot-from-2020-06-05-08-52-21-lg.png 1024w ,https://lecaro.me/media/posts/8/responsive/Screenshot-from-2020-06-05-08-52-21-xl.png 1360w ,https://lecaro.me/media/posts/8/responsive/Screenshot-from-2020-06-05-08-52-21-2xl.png 1600w"  alt="Screenshot of the mermaid add-on in the g-suite marketplace" width="989" height="731">
<figcaption >The mermaid add-on listed in the g-suite marketplace </figcaption>
</figure>
<p> </p>
<p>The project has evolved a bit with time but stays relatively simple in terms of code. It has gathered quite a lot of users (10K) despite me not putting any efforts in marketing it. I guess we have a product-market fit here, but no business plan at all. This is really just a few lines of JavaScript to make the power of the mermaid JS library available in google docs. I don't think it makes sense to charge for it, and it costs nothing to keep it running. </p>
<p>I've made it open source, with the code hosted on github, feel free to have a look there : <a href="https://github.com/renanlecaro/mermaid-gdocs">https://github.com/renanlecaro/mermaid-gdocs</a></p>
<p><a href="https://gsuite.google.com/marketplace/app/mermaid/636321283856?pann=cwsdp&amp;hl=en"> The mermaid add-on listed in the g-suite marketplace </a></p>
<p> </p>
            ]]>
        </content>
    </entry>
</feed>
