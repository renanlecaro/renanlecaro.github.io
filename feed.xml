<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <title>Renan LE CARO</title>
    <link href="https://lecaro.me/feed.xml" rel="self" />
    <link href="https://lecaro.me" />
    <updated>2021-07-05T17:39:41+02:00</updated>
    <author>
        <name>Renan LE CARO</name>
    </author>
    <id>https://lecaro.me</id>

    <entry>
        <title>One liner to watch the current folder and tree its structure</title>
        <author>
            <name>Renan LE CARO</name>
        </author>
        <link href="https://lecaro.me/one-liner-to-watch-the-current-folder-and-tree-its-structure.html"/>
        <id>https://lecaro.me/one-liner-to-watch-the-current-folder-and-tree-its-structure.html</id>

        <updated>2021-07-05T17:39:41+02:00</updated>
            <summary>
                <![CDATA[
                    I've been working with smstools3 which uses a folder and its subfolder as its state store. Instead of running "tree" manually in the /var/spool/sms folder, i'd rather have it be done automagically whenever the files change. I've used inotifywait for that, which needs to be&hellip;
                ]]>
            </summary>
        <content type="html">
            <![CDATA[
                <p>I've been working with smstools3 which uses a folder and its subfolder as its state store. </p>
<p>Instead of running "tree" manually in the /var/spool/sms folder, i'd rather have it be done automagically whenever the files change.</p>
<p>I've used <strong>inotifywait </strong>for that, which needs to be installed on ubuntu with <strong>sudo apt install inotify-tools</strong> .</p>
<p>Then it's just a matter of cd-ing to the proper directory and running :</p>
<p><strong>clear &amp;&amp; tree &amp;&amp; inotifywait --monitor --quiet --recursive --event modify . | while read; do clear; tree; done</strong></p>
<figure class="post__image post__image--center" ><img loading="lazy" src="https://lecaro.me/media/posts/25/inotify-result.png" sizes="(max-width: 48em) 100vw, 768px" srcset="https://lecaro.me/media/posts/25/responsive/inotify-result-xs.png 300w ,https://lecaro.me/media/posts/25/responsive/inotify-result-sm.png 480w ,https://lecaro.me/media/posts/25/responsive/inotify-result-md.png 768w ,https://lecaro.me/media/posts/25/responsive/inotify-result-lg.png 1024w ,https://lecaro.me/media/posts/25/responsive/inotify-result-xl.png 1360w ,https://lecaro.me/media/posts/25/responsive/inotify-result-2xl.png 1600w"  alt="Screenshot of the result, it will refresh whenever files change" width="409" height="348">
<figcaption >Result</figcaption>
</figure>
<p> </p>
            ]]>
        </content>
    </entry>
    <entry>
        <title>Youtube music is Meh</title>
        <author>
            <name>Renan LE CARO</name>
        </author>
        <link href="https://lecaro.me/youtube-music-is-terrible.html"/>
        <id>https://lecaro.me/youtube-music-is-terrible.html</id>

        <updated>2021-05-18T12:49:48+02:00</updated>
            <summary>
                <![CDATA[
                    Spotify was a bit buggy on my laptop a while ago so I stopped my premium plan. I used the excellent soundiiz to transfer my playlists over to youtube (in small 200 tracks batches), where I had a premium account. The thing is, youtube music&hellip;
                ]]>
            </summary>
        <content type="html">
            <![CDATA[
                <p>Spotify was a bit buggy on my laptop a while ago so I stopped my premium plan.</p>
<p>I used the excellent <a href="https://soundiiz.com">soundiiz</a> to transfer my playlists over to youtube (in small 200 tracks batches), where I had a premium account.</p>
<p>The thing is, youtube music uses the videos as audio source, and artists often add noise to the video clips to make the "listen for free" youtube experience inferior to buying a cd.</p>
<p>And I end up paying to listen to this crap. </p>
<p>Edit : the "mix" feature tends to mostly play songs that are "clean". It's more my imported likes that have the added noise.</p>
<p>I actually kind of like what youtube is auto playing, and I've discovered a few good new tracks. For the price I pay (~3€/month, i'm still on a Russian plan =D ) I'd say the service quality is fair. </p>
<p> </p>
<p> </p>
            ]]>
        </content>
    </entry>
    <entry>
        <title>Github action to deploy a meteor app to digital ocean </title>
        <author>
            <name>Renan LE CARO</name>
        </author>
        <link href="https://lecaro.me/github-action-to-deploy-a-meteor-app-to-digital-ocean.html"/>
        <id>https://lecaro.me/github-action-to-deploy-a-meteor-app-to-digital-ocean.html</id>

        <updated>2021-04-02T16:33:12+02:00</updated>
            <summary>
                <![CDATA[
                    Why no galaxy ? My main app (https://ciboulette.net) is a meteor app. I love meteor, and I'm glad it's recently received some new funding and new updates. However, the official way to host a meteor app, meteor galaxy, is super expensive for a small indie&hellip;
                ]]>
            </summary>
        <content type="html">
            <![CDATA[
                <h2>Why no galaxy ? </h2>
<p>My main app (<a href="https://ciboulette.net">https://ciboulette.net</a>) is a meteor app. I love meteor, and I'm glad it's recently received some new funding and new updates. </p>
<p>However, the official way to host a meteor app, meteor galaxy, is super expensive for a small indie project. I can understand that server costs are usually not significant, but if i can get away with 15$ a month instead of 115$ well rather do that.</p>
<p>Of course if I had to pay someone 100$/hour to manage my servers, it would be a different story.</p>
<figure class="post__image"><img loading="lazy"  src="https://lecaro.me/media/posts/23/comparison.png" sizes="(max-width: 48em) 100vw, 768px" srcset="https://lecaro.me/media/posts/23/responsive/comparison-xs.png 300w ,https://lecaro.me/media/posts/23/responsive/comparison-sm.png 480w ,https://lecaro.me/media/posts/23/responsive/comparison-md.png 768w ,https://lecaro.me/media/posts/23/responsive/comparison-lg.png 1024w ,https://lecaro.me/media/posts/23/responsive/comparison-xl.png 1360w ,https://lecaro.me/media/posts/23/responsive/comparison-2xl.png 1600w"  alt="Meteor and digital ocean pricing side by side" width="1910" height="795"></figure>
<p>Anyway, i'm really happy with my meteor up + digital ocean setup, but the deploys take forever when you have a bad DSL connection (0.8 MB/s upload, whoo) so I looked for a way to get my deploys to happen in the cloud.</p>
<p>The cheapest (free) and simplest solution I found was github actions.</p>
<p>Here's the github action for one of my open source repositories : <a href="https://github.com/renanlecaro/simpletextnet/blob/master/.github/workflows/main.yml">https://github.com/renanlecaro/simpletextnet/blob/master/.github/workflows/main.yml</a></p>
<p>The idea is :</p>
<ul>
<li>Get "mup deploy" working locally</li>
<li>Add the required ssh keys to the github action runner as secrets</li>
<li> Run mup deploy from the runner</li>
</ul>
<p>It's not rocket science, really, it was just not as straighforward as I hoped it would be. </p>
<p>Below, the main action code</p>
<pre>name: Deploy meteor app to digital ocean with meteor up<br>on:<br>  push:<br>    branches: [ master ]<br>  workflow_dispatch:<br><br>jobs:<br>  build:<br>    runs-on: ubuntu-latest<br>    steps:<br><br>      # we setup ssh first as it is quick, so the action will fail <br>      # fast during the installation on a new repository<br>      - name: Install SSH key<br>        uses: shimataro/ssh-key-action@v2<br>        with:<br>          key: ${{ secrets.SSH_KEY }}<br>          known_hosts: ${{ secrets.KNOWN_HOSTS }}<br><br>      # just a dummy request to check the communication with the server<br>      # is ok, we'll upload after building<br>      - name: Test ssh key to fail fast<br>        run: ssh root@188.166.160.106 -t "pwd"<br><br>      # get the source<br>      - uses: actions/checkout@v2<br><br>      # install only the production dependencies<br>      - name: get production dependencies only<br>        run: npm install --production<br><br>      # install mup without the -g flag <br>      - name: install mup locally<br>        run: npm install mup<br><br>      # install meteor to be able to build the app as a bundle<br>      - name: install meteor<br>        run: curl https://install.meteor.com/ | sh<br><br>      # upload the bundle. Here, the .production folder is app specific.<br>      # You need to get to the folder with your mup.js file.<br>      - name: Bundle the app and upload to Digital Ocean<br>        run: cd ./.production &amp;&amp; npx mup deploy</pre>
            ]]>
        </content>
    </entry>
    <entry>
        <title>How to send SMSs with an 8x modem and Ubuntu </title>
        <author>
            <name>Renan LE CARO</name>
        </author>
        <link href="https://lecaro.me/how-to-start-an-ubuntu-sms-farm.html"/>
        <id>https://lecaro.me/how-to-start-an-ubuntu-sms-farm.html</id>

        <updated>2021-05-18T12:58:59+02:00</updated>
            <summary>
                <![CDATA[
                    Why start an SMS "farm" ? SMS messages are super expensive in France. 0.06€ / message on Twilio, Vonage, etc... So I've resorted to sending SMSs using private phone plans. They are super cheap in france, 2€/month for unlimited SMSs. I'm using one such plan&hellip;
                ]]>
            </summary>
        <content type="html">
            <![CDATA[
                <h2>Why start an SMS "farm" ? </h2>
<p>SMS messages are super expensive in France.</p>
<p><strong> 0.06€ / message</strong> on Twilio, Vonage, etc...</p>
<p>So I've resorted to sending SMSs using private phone plans. They are super cheap in france, 2€/month for unlimited SMSs.</p>
<p>I'm using one such plan to send SMSs today, with an old android phone and an SMS gateway app that's not very reliable. I'm sending low volumes of SMS, so it's doing ok, but i'm getting ready to send way more SMSs for many additional users.</p>
<p>I could try to send all the sms from one phone, but the "unlimited SMS" plans actually have an undisclosed hard limit on how much you can send. </p>
<p>So i'm planning to pool a bunch of SIM cards, SMS farm style, to send the SMSs of ciboulette.net</p>
<h2>Picking a modem (95€)</h2>
<table style="border-collapse: collapse; width: 100%; height: 416px;" border="0">
<tbody>
<tr style="height: 416px;">
<td style="width: 50%; height: 416px;"><figure class="post__image"><img loading="lazy"  style="color: var(--text-editor-body-color); font-family: var(--font-base); font-size: 18.4px; font-weight: var(--font-weight-normal); outline: 3px solid rgba(var(--primary-color-rgb), 0.55)  !important;" src="https://lecaro.me/media/posts/22/Screenshot-from-2021-04-02-12-28-31.png" sizes="(max-width: 48em) 100vw, 768px" srcset="https://lecaro.me/media/posts/22/responsive/Screenshot-from-2021-04-02-12-28-31-xs.png 300w ,https://lecaro.me/media/posts/22/responsive/Screenshot-from-2021-04-02-12-28-31-sm.png 480w ,https://lecaro.me/media/posts/22/responsive/Screenshot-from-2021-04-02-12-28-31-md.png 768w ,https://lecaro.me/media/posts/22/responsive/Screenshot-from-2021-04-02-12-28-31-lg.png 1024w ,https://lecaro.me/media/posts/22/responsive/Screenshot-from-2021-04-02-12-28-31-xl.png 1360w ,https://lecaro.me/media/posts/22/responsive/Screenshot-from-2021-04-02-12-28-31-2xl.png 1600w"  alt="Picture of the modem" width="432" height="449"></figure></td>
<td style="width: 50%; height: 416px;">
<p>The first step was buying a modem pool, i got this one on aliexpress : <a href="https://www.aliexpress.com/item/32477370996.html">FIMT 1/8/16/32/64 ports USB modem pool/GSM sms modem /gsm modem pool edge gprs modem driver</a></p>
<p>It took about 10 days to arrive in France.</p>
<p>The ad only talked about how it would work on Windows, so it was a bit of a gamble to try to use it on an Ubuntu server.</p>
</td>
</tr>
</tbody>
</table>
<p>The modem looks alright, the only problem that i see is that the USB and power adaptor look like cheap stuffs, and easily get disconnected. That's in contrast with the very "pro" looking gadget itself.</p>
<h2>Sending your first SMS with Ubuntu</h2>
<p>It took me forever to understand that this modem didn't need any extra drivers, I was just doing it wrong.</p>
<p>I'm only using one sim card for now, i'll buy more as the needs arise.</p>
<p>First, make sure you disable the SIM PIN code, using any compatible phone.</p>
<p>Then insert the sim in any of the bays, make sure the switch for that bay is on,and turn all the empty slots off.</p>
<p>Connect the antenna because it looks cool (not sure if it does anything really). </p>
<figure class="post__image"><img loading="lazy"  src="https://lecaro.me/media/posts/22/IMG_20210402_122254.jpg" sizes="(max-width: 48em) 100vw, 768px" srcset="https://lecaro.me/media/posts/22/responsive/IMG_20210402_122254-xs.jpg 300w ,https://lecaro.me/media/posts/22/responsive/IMG_20210402_122254-sm.jpg 480w ,https://lecaro.me/media/posts/22/responsive/IMG_20210402_122254-md.jpg 768w ,https://lecaro.me/media/posts/22/responsive/IMG_20210402_122254-lg.jpg 1024w ,https://lecaro.me/media/posts/22/responsive/IMG_20210402_122254-xl.jpg 1360w ,https://lecaro.me/media/posts/22/responsive/IMG_20210402_122254-2xl.jpg 1600w"  alt="The glorious modem with its sim card" width="696" height="928"></figure>
<p class="align-center">The modem</p>
<p> </p>
<figure class="post__image"><img loading="lazy"  src="https://lecaro.me/media/posts/22/IMG_20210402_122302.jpg" sizes="(max-width: 48em) 100vw, 768px" srcset="https://lecaro.me/media/posts/22/responsive/IMG_20210402_122302-xs.jpg 300w ,https://lecaro.me/media/posts/22/responsive/IMG_20210402_122302-sm.jpg 480w ,https://lecaro.me/media/posts/22/responsive/IMG_20210402_122302-md.jpg 768w ,https://lecaro.me/media/posts/22/responsive/IMG_20210402_122302-lg.jpg 1024w ,https://lecaro.me/media/posts/22/responsive/IMG_20210402_122302-xl.jpg 1360w ,https://lecaro.me/media/posts/22/responsive/IMG_20210402_122302-2xl.jpg 1600w"  alt="Close up to show the direction of the sim card" width="696" height="928"></figure>
<p class="align-center">Close up of the sim bay, with the sim card half out to show in which direction to insert it.</p>
<p>Connect the power adapter, the usb cable, turn the device on. The blue led next to the sim should blink shortly every ~5 seconds. </p>
<p>Turn on your Ubuntu computer.</p>
<p>Let's first install our tools </p>
<pre>sudo apt-get install wvdial screen minicom smstools</pre>
<p>Type yes when/if needed</p>
<p> </p>
<p>Next, we need to find out modem, run </p>
<pre>sudo wvdialconf</pre>
<p>It will scan the various ports to try to find a modem that answers to its requests, and then try to detect the best transfer rate to use.</p>
<p><strong>Edit : wvdialconf stopped working for me a few months after writing the original article. There seem to have been a driver change, and my device, originally listed as /dev/ttyACM6 is now /dev/ttyXRUSB6. wvdialconf could not find it, but it still works fine with different tools. go figure.</strong></p>
<p>It might fail on the first try, then run it again, until you get something like this</p>
<pre>Found an USB modem on <strong>/dev/ttyACM6</strong>.<br>Modem configuration written to /etc/wvdial.conf.<br>ttyACM6&lt;Info&gt;: Speed <strong>38400</strong>; init "ATQ0 V1 E1 S0=0 &amp;C1 &amp;D2"</pre>
<p>We found our modem. Next we'll need to talk directly to it with AT commande, to send our first message. </p>
<p>The difficulty is that AT commands are a super old standard, and require at some point to send the control character "ctrl+z". If you do that in a normal prompt, it will be recognised as a keyboard shortcut and not be sent as a character.</p>
<p>So we have to connect to the modem using a very low level interface.</p>
<pre>sudo screen <strong>/dev/ttyACM6 38400</strong></pre>
<p><strong>Edit: if wvdialconf didn't work, try to connect using mincom : minicom -D /dev/ttyXRUSB6 . To type the ctrl+z character sequence in minicom, type ctrl+v, then ctrl+z</strong></p>
<p>You need to replace the arguments with the corresponding values returned at the last step.</p>
<p>This opens a blank screen, type <strong>AT</strong> then press enter, the screen should display an "OK" answer from the modem. </p>
<p>To go to sms mode, type <strong>AT+CMGF=1</strong> and validate with enter. It should reply "OK"</p>
<p>To start an sms, type <strong>AT+CMGS="+3362XXXXXXX" (</strong>replace the XXX with your actual phone number) and press enter. It should go to the next line and show a "&gt;" character. </p>
<p>Type the content of your message (possibly on multiple lines) then <strong>validate with ctrl+Z</strong></p>
<p>It should lag for a second or two then display something like "+CMGS: 6 OK"</p>
<p>You should then receive the sms on your phone. </p>
<p>Exit the "screen" command by pressing "ctrl+A" followed by pressing "d".</p>
<p>Summary of the commands :</p>
<pre>AT<br>OK<br>AT+CMGF=1<br>OK<br>AT+CMGS="+3362XXXXXXX"<br>  &gt; Hey there<br>+CMGS: 6<br><br>OK</pre>
<p>Once this works, you can investigate SMS servers like <a href="http://smstools3.kekekasvi.com/">smstools</a> </p>
<p>The basics are to edit the configuration file for smstools to indicate your device location:</p>
<pre><code>sudo nano /etc/smsd.conf</code><br><br><code>[GSM1]</code><br><code>#init = </code><br><code>device = /dev/<strong>ttyXRUSB6</strong></code><br><code>incoming = yes</code><br><code>#pin = </code><br><code>baudrate = 19200</code></pre>
<p>And then create a file in /var/spool/sms/outgoing/ (the sms outbox) with the sms to send :</p>
<pre>To: 33628350XXXX<br><br><br>Hey this is a message from smstools</pre>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
            ]]>
        </content>
    </entry>
    <entry>
        <title>Github action to check for TODOs and FIXMEs</title>
        <author>
            <name>Renan LE CARO</name>
        </author>
        <link href="https://lecaro.me/github-action-to-check-for-todos-and-fixmes.html"/>
        <id>https://lecaro.me/github-action-to-check-for-todos-and-fixmes.html</id>

        <updated>2021-03-29T01:16:37+02:00</updated>
            <summary>
                <![CDATA[
                    I had some TODO and FIXME instructions in random locations in my code that served no purpose, as I was never looking for them. I also use "console.log" for temporary debug logs that should be removed in production. I sometimes forget some console.log statements, and&hellip;
                ]]>
            </summary>
        <content type="html">
            <![CDATA[
                <p>I had some TODO and FIXME instructions in random locations in my code that served no purpose, as I was never looking for them. I also use "console.log" for temporary debug logs that should be removed in production. </p>
<p>I sometimes forget some console.log statements, and basically always ignore the TODO/FIXME comments. </p>
<p>So i made a very simple script that fails if there are TODOs, FIXMEs or console.log in your code. This way the PR won't look like it's passing if it's missing an important part.</p>
<p>Save it in .github/workflows/check_todos.yml</p>
<pre>name: Look for todos and fixmes<br>on:<br>  pull_request:<br>    branches:<br>      - master<br>jobs:<br>  build:<br>    runs-on: ubuntu-latest<br>    steps:<br>      - uses: actions/checkout@v2<br>      - run: |<br>         if grep --exclude-dir={.git,.github} -rE "TODO|FIXME|console\.log"; then<br>              exit 1<br>         else<br>             echo "All good"<br>         fi<br><br></pre>
<p>I exclude .git because it could contain the text. And I exclude .github so that the regex doesn't match itself. Package files should not be a problem as the script doesn't pull any external dependencies (no npm install)  </p>
<p>The search is case sensitive, so it will only trip for clear TODOs and not some random method names.</p>
<p>You get the results really quickly, and because only the source is checked out ,all the generated files/packages should be excluded from the search.</p>
<figure class="post__image"><img loading="lazy"  src="https://lecaro.me/media/posts/21/Screenshot-from-2021-03-29-01-16-12.png" sizes="(max-width: 48em) 100vw, 768px" srcset="https://lecaro.me/media/posts/21/responsive/Screenshot-from-2021-03-29-01-16-12-xs.png 300w ,https://lecaro.me/media/posts/21/responsive/Screenshot-from-2021-03-29-01-16-12-sm.png 480w ,https://lecaro.me/media/posts/21/responsive/Screenshot-from-2021-03-29-01-16-12-md.png 768w ,https://lecaro.me/media/posts/21/responsive/Screenshot-from-2021-03-29-01-16-12-lg.png 1024w ,https://lecaro.me/media/posts/21/responsive/Screenshot-from-2021-03-29-01-16-12-xl.png 1360w ,https://lecaro.me/media/posts/21/responsive/Screenshot-from-2021-03-29-01-16-12-2xl.png 1600w"  alt="Screenshot of a failed build" width="989" height="386"></figure>
            ]]>
        </content>
    </entry>
    <entry>
        <title>Configuring i3 for headful e2e tests</title>
        <author>
            <name>Renan LE CARO</name>
        </author>
        <link href="https://lecaro.me/configuring-i3-for-headful-e2e-tests.html"/>
        <id>https://lecaro.me/configuring-i3-for-headful-e2e-tests.html</id>

        <updated>2021-03-27T11:52:52+01:00</updated>
            <summary>
                <![CDATA[
                    i3 is nice. End to end tests are nice. Chromium is nice. But they don't get along so well by default. When you run you e2e script with nodemon, each run opens and closes the test browser window. By default, that window appears right by&hellip;
                ]]>
            </summary>
        <content type="html">
            <![CDATA[
                <p>i3 is nice. End to end tests are nice. Chromium is nice. But they don't get along so well by default.</p>
<p>When you run you e2e script with nodemon, <strong>each run opens and closes the test browser</strong> window. By default, that window appears <strong>right by your editor</strong>, messing the layout.</p>
<p>It's easy to fix though : you just need to <strong>tell i3 what to do with that test browser window</strong>.</p>
<p>To make every new chromium window appear in the workspace $ws5, add this in ~/.config/i3/config</p>
<p><code>assign [class="Chromium-browser"] → $ws5</code></p>
<p>The workspace name is a variable here, but you can put anything. I assign that window to a rarely used workspace. </p>
<p>Chromium has a different class from Google Chrome, so this has no impact on where the "real" browser is started.</p>
<p>To get the class infos for other browsers, run <code>xprop</code> in a terminal and then click on a window.  </p>
            ]]>
        </content>
    </entry>
    <entry>
        <title>Using Trello for feature requests / priorisation </title>
        <author>
            <name>Renan LE CARO</name>
        </author>
        <link href="https://lecaro.me/using-trello-for-feature-requests-priorisation.html"/>
        <id>https://lecaro.me/using-trello-for-feature-requests-priorisation.html</id>

        <updated>2021-03-26T22:30:45+01:00</updated>
            <summary>
                <![CDATA[
                    I have a few users for my app, and 1000's of ideas on how to improve it. I've been tracking my work in trello, on a public board (my app is still closed source, but i'm as open as possible about the processes of my&hellip;
                ]]>
            </summary>
        <content type="html">
            <![CDATA[
                <p>I have a few users for my app, and 1000's of ideas on how to improve it. </p>
<p>I've been tracking my work in trello, on a public board (my app is still closed source, but i'm as open as possible about the processes of my work). </p>
<figure class="post__image"><img loading="lazy"  src="https://lecaro.me/media/posts/19/Screenshot-from-2021-03-26-22-25-06.png" sizes="(max-width: 48em) 100vw, 768px" srcset="https://lecaro.me/media/posts/19/responsive/Screenshot-from-2021-03-26-22-25-06-xs.png 300w ,https://lecaro.me/media/posts/19/responsive/Screenshot-from-2021-03-26-22-25-06-sm.png 480w ,https://lecaro.me/media/posts/19/responsive/Screenshot-from-2021-03-26-22-25-06-md.png 768w ,https://lecaro.me/media/posts/19/responsive/Screenshot-from-2021-03-26-22-25-06-lg.png 1024w ,https://lecaro.me/media/posts/19/responsive/Screenshot-from-2021-03-26-22-25-06-xl.png 1360w ,https://lecaro.me/media/posts/19/responsive/Screenshot-from-2021-03-26-22-25-06-2xl.png 1600w"  alt="The development board" width="1913" height="925"></figure>
<p class="align-center">The <a href="https://trello.com/b/GaZSJzzq/planning-de-d%C3%A9veloppement-de-ciboulettenet">development board</a> (in French)</p>
<p>I'm the only one doing development work here, but I've invited my clients to join the board. I instructed them to just "join" any card that seems like it would be useful to them. I only invited paying customers. </p>
<p>It's a great way to focus on what's really needed. But i tend to work on some technical stuffs that don't really matter to them right now (like the <a href="https://lecaro.me/meteor-lags-aggregates-to-the-rescue.html">last post</a> about aggregation suggests) so I can't always prioritise what's asked. </p>
<p>And I get some Trello gold after every signup, but I'm not sure why I should care. </p>
<p>Ideally, I'd like something similar but integrated in my app, to let users voice their opinions and needs without friction, but I thought i'd postpone that to the time where all the cards with a person on it are already done. </p>
<p>And services like this already exist I guess, so it's not really worth investing much effort in creating a custom solution.  </p>
            ]]>
        </content>
    </entry>
    <entry>
        <title>Meteor lags ? Aggregates to the rescue !</title>
        <author>
            <name>Renan LE CARO</name>
        </author>
        <link href="https://lecaro.me/meteor-lags-aggregates-to-the-rescue.html"/>
        <id>https://lecaro.me/meteor-lags-aggregates-to-the-rescue.html</id>

        <updated>2021-03-26T22:21:33+01:00</updated>
            <summary>
                <![CDATA[
                    My app has 4 main collections in mongo : - A user has many weeks and clients - Each week has many orders, one per client, where the order content is stored (can be empty if the client didn't order that week). Initially, my documents&hellip;
                ]]>
            </summary>
        <content type="html">
            <![CDATA[
                <p>My app has 4 main collections in mongo : </p>
<p>- A <strong>user </strong>has many <strong>weeks </strong>and <strong>clients</strong></p>
<p>- Each week has many <strong>orders</strong>, one per client, where the order content is stored (can be empty if the client didn't order that week). </p>
<p>Initially, my documents were quite dry, I was doing the "joins" work on the client. It got laggy though, so I moved the joins logic to the meteor server, with <strong>hooks</strong> (<strong>matb33:collection-hooks) </strong>in every directions to keep denormalized fields in sync. </p>
<figure class="post__image"><img loading="lazy"  src="https://trello-attachments.s3.amazonaws.com/605b848835c8f765d6d4626e/1025x564/5235adb0e560fb8de807e8488b2e67ec/image.png" data-is-external-image="true"  alt="My mess of hooks, simplified, visualized" width="718" height="395"></figure>
<p>It was a pain though, really hard to follow what was going on and to debug. </p>
<p>There's also potential for chain reactions and never ending hooks loops. </p>
<p>But mostly, it was <strong>buggy in edge cases</strong>. </p>
<p>So I'm migrating away from those hooks, and creating an aggregation pipeline per collection (week, client, order) that computes all the dynamic fields for some given ids, and returns the documents where the value is different, plus some additional ids to check in the next pass. </p>
<p>It's not yet in production, but after this rewrite, my e2e tests are passing. </p>
<p>Meteor uses mongodb 4.2 in development server. I didn't feel like forcing an update to 4.4, which brings in two very useful features for my use case (the<a href="https://docs.mongodb.com/manual/reference/operator/aggregation/function/"> $function</a> operator and the ability to <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/merge/#output-to-the-same-collection-that-is-being-aggregated">$merge</a> to the collection that you are aggregating on).</p>
<p>So I've been $writing:{ $some: {$nested: {$queries:'It's a pain''}}} . I'm back to junior level of mastery in this new paradigm, where "It works" comes as a surprise. I'm sure i'll rewrite those ugly aggregations at some point, but for now they seem to do the job. </p>
<p>One nice approach to using aggregation pipelines in meteor is to declare them in a separate js file, and then have a simple, non-meteor script that runs the aggregation and logs the results. </p>
<p>I use nodemon to watch the files, and get a very fast feedback loop, without the need to wait for the meteor server to recompile. Great when you're learning as you go. </p>
<p>I start the script like this (-r esm allows me to use modern imports) </p>
<pre>nodemon -e js  -r esm tests/scripts/mongofun.js</pre>
<p> And the script itself is very simple. It just runs the query </p>
<p>tests/scripts/mongofun.js :</p>
<pre>const mongoUrl='mongodb://127.0.0.1:3001/meteor'<br><br>async function actual_aggregation(db) {<br>  const result = await db<br>    .collection('Orders')<br>    .aggregate([<br>      {<br>        $match: {_id:'&lt;some test id&gt;'}<br>      }, <br>      ...the_pipeline_imported_from_the_meteor_source<br>    ])<br>    .toArray();<br>  console.log(result);<br>}<br><br>const mongodb = require('mongodb');<br>const client = new mongodb.MongoClient(mongoUrl, {<br>  useUnifiedTopology: true<br>});<br><br>client.connect().then(<br>  async () =&gt; {<br>    const start = Date.now();<br>    await author_aggregation(client.db());<br>    console.log('took ' + (Date.now() - start) + ' ms');<br>  },<br>  e =&gt; console.error(e)<br>);</pre>
<p>Anyway, that's all for today :)</p>
            ]]>
        </content>
    </entry>
    <entry>
        <title>Basic i3blocks controls for ubuntu rhythmbox</title>
        <author>
            <name>Renan LE CARO</name>
        </author>
        <link href="https://lecaro.me/basic-i3blocks-controls-for-ubuntu-rhythmbox.html"/>
        <id>https://lecaro.me/basic-i3blocks-controls-for-ubuntu-rhythmbox.html</id>

        <updated>2021-03-26T22:22:27+01:00</updated>
            <summary>
                <![CDATA[
                    I've switched over from Spotify to Rhythmbox today. Spotify was a bit unstable on my system, it sometimes even struggled to playback offline playlists. I'm back to the good old "music" folder with files of long forgotten origins. The default ubuntu music player, rhythmbox, seems&hellip;
                ]]>
            </summary>
        <content type="html">
            <![CDATA[
                <p>I've switched over from Spotify to Rhythmbox today. Spotify was a bit unstable on my system, it sometimes even struggled to playback offline playlists.</p>
<p>I'm back to the good old "music" folder with files of long forgotten origins.  </p>
<p>The default ubuntu music player, rhythmbox,  seems not too bad, i don't need it to do much anyway. </p>
<p>I just had to port my i3 bar script to : </p>
<ul>
<li>show the track currently playing</li>
<li>go to next track on right click</li>
<li>play/pause on left click<br><br></li>
</ul>
<p> </p>
<figure class="post__image align-center"><img loading="lazy"  src="https://lecaro.me/media/posts/17/i3script" alt="" width="478" height="53"></figure>
<p>The look of the "widget", pretty basic. </p>
<p>I wanted to add a play/pause icon but </p>
<ul>
<li>i didn't find a way to ask rhythmbox-client if the  music is played or paused</li>
<li>my ears are usually enough to know if anything i s playing </li>
</ul>
<p>I also added a little regexp to remove anything in parenthesis in the track name, to remove "(Original mix)" mentions and such. </p>
<p>.config/i3/i3blocks.conf :</p>
<pre>[music]<br>command=node ~/.config/i3/rhythmbox.js<br>interval=5</pre>
<p><span style="color: var(--text-editor-body-color); font-family: var(--font-base); font-size: inherit; font-weight: var(--font-weight-normal);">The actual node script (I suck at bash, that's why i'm using node for this)</span></p>
<p><span style="color: var(--text-editor-body-color); font-family: var(--font-base); font-size: inherit; font-weight: var(--font-weight-normal);">~/.config/i3/rhythmbox.js</span></p>
<pre><br>const {execSync}=require('child_process')<br><br>// apply click actions<br>switch(process.env.BLOCK_BUTTON){<br>  case  '1': execSync('rhythmbox-client --play-pause');<br>    break; <br>  case  '3': execSync('rhythmbox-client --next');<br>    break;<br>}<br><br>// get track name<br>const playing=(execSync('rhythmbox-client --print-playing').toString())||'';<br><br>// clean track name<br>const formatted=playing.replace(/\([^\)]+\)/gi,'')<br><br>// output it<br>console.log(formatted);</pre>
            ]]>
        </content>
    </entry>
    <entry>
        <title>3 video games I&#x27;ve spent 100+ hours on</title>
        <author>
            <name>Renan LE CARO</name>
        </author>
        <link href="https://lecaro.me/3-video-games-ive-spend-100-hours-on.html"/>
        <id>https://lecaro.me/3-video-games-ive-spend-100-hours-on.html</id>

        <updated>2021-03-25T10:06:17+01:00</updated>
            <summary>
                <![CDATA[
                    I don't really play much those days, but I've had some great gaming experiences I felt like sharing today. This strategy game is free, ad free, and has an amazing replay-ability thanks to the user generated levels. It's easy to learn, and not too hard&hellip;
                ]]>
            </summary>
        <content type="html">
            <![CDATA[
                <p>I don't really play much those days, but I've had some great gaming experiences I felt like sharing today.</p>
<table style="border-collapse: collapse; width: 100%;" border="0">
<tbody>
<tr>
<td style="width: 50%;"><figure class="post__image align-center"><img loading="lazy"  src="https://lecaro.me/media/posts/16/antiyoy.png" sizes="(max-width: 48em) 100vw, 768px" srcset="https://lecaro.me/media/posts/16/responsive/antiyoy-xs.png 300w ,https://lecaro.me/media/posts/16/responsive/antiyoy-sm.png 480w ,https://lecaro.me/media/posts/16/responsive/antiyoy-md.png 768w ,https://lecaro.me/media/posts/16/responsive/antiyoy-lg.png 1024w ,https://lecaro.me/media/posts/16/responsive/antiyoy-xl.png 1360w ,https://lecaro.me/media/posts/16/responsive/antiyoy-2xl.png 1600w"  alt="" width="240" height="400"></figure></td>
<td style="width: 50%;">
<h2>Antiyoy - Android</h2>
<p> This <strong>strategy</strong> game is free, ad free, and has an amazing replay-ability thanks to the user generated levels.  </p>
<p>It's <strong>easy to learn</strong>, and not too hard to master, after a while most levels are trivial. </p>
<p>Some get tough though, and I had to look at the solutions from random Russian Youtube videos at times. </p>
</td>
</tr>
<tr>
<td style="width: 50%;"><figure class="n3VNCb"><img loading="lazy"  src="https://i.ytimg.com/vi/J8SBp4SyvLc/maxresdefault.jpg" data-is-external-image="true"  alt="Factorio - Trailer 2020 - YouTube" data-noaft="1"></figure></td>
<td style="width: 50%;">
<h2>Factorio - Linux</h2>
<p>It's one of those game that's programmer's heaven. Or hell. It's very similar to <strong>programming</strong> (design, debugging, automating, constantly learning) <strong>but with guns</strong>.</p>
</td>
</tr>
<tr>
<td style="width: 50%;"><figure class="n3VNCb"><img loading="lazy"  src="https://upload.wikimedia.org/wikipedia/commons/thumb/e/ef/Nuclear_Throne_screenshot_10.png/1200px-Nuclear_Throne_screenshot_10.png" data-is-external-image="true"  alt="Nuclear Throne — Wikipédia" data-noaft="1"></figure></td>
<td style="width: 50%;">
<h2>Nuclear throne - Linux</h2>
<p>This is one of the <strong>roguelikes</strong> I sicked to, and after a while i got pretty good at it. <strong>Runs are short</strong>, so it's perfect to spend a few minutes before starting a complicated topic. It's frustrating enough that you don't end up playing 2 hours without realising it.  </p>
</td>
</tr>
</tbody>
</table>
<p> </p>
            ]]>
        </content>
    </entry>
</feed>
