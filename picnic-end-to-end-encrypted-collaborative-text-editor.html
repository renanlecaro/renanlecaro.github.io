<!DOCTYPE html><html lang="en-gb"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Picnic: end-to-end encrypted collaborative text editor - Renan LE CARO</title><meta name="description" content="I felt like having a small break from my main project this month, so I'm giving myself some weeks to try out other ideas I've been putting off. Just happy coding of open source MVPs for various ideas I've had for a while. I'm giving&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://lecaro.me/picnic-end-to-end-encrypted-collaborative-text-editor.html"><link rel="alternate" type="application/atom+xml" href="https://lecaro.me/feed.xml"><link rel="alternate" type="application/json" href="https://lecaro.me/feed.json"><meta property="og:title" content="Picnic: end-to-end encrypted collaborative text editor"><meta property="og:site_name" content="Renan LE CARO"><meta property="og:description" content="I felt like having a small break from my main project this month, so I'm giving myself some weeks to try out other ideas I've been putting off. Just happy coding of open source MVPs for various ideas I've had for a while. I'm giving&hellip;"><meta property="og:url" content="https://lecaro.me/picnic-end-to-end-encrypted-collaborative-text-editor.html"><meta property="og:type" content="article"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@RenanLeCaro"><meta name="twitter:title" content="Picnic: end-to-end encrypted collaborative text editor"><meta name="twitter:description" content="I felt like having a small break from my main project this month, so I'm giving myself some weeks to try out other ideas I've been putting off. Just happy coding of open source MVPs for various ideas I've had for a while. I'm giving&hellip;"><link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin><style>:root {
              --body-font: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
              --heading-font: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
              --logo-font: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
              --menu-font: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
           }</style><link rel="stylesheet" href="https://lecaro.me/assets/css/main.css?v=adf9c646ca416aff97afd632c9133472"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://lecaro.me/picnic-end-to-end-encrypted-collaborative-text-editor.html"},"headline":"Picnic: end-to-end encrypted collaborative text editor","datePublished":"2022-01-10T23:27","dateModified":"2022-01-10T23:31","description":"I felt like having a small break from my main project this month, so I'm giving myself some weeks to try out other ideas I've been putting off. Just happy coding of open source MVPs for various ideas I've had for a while. I'm giving&hellip;","author":{"@type":"Person","name":"Renan LE CARO"},"publisher":{"@type":"Organization","name":"Renan LE CARO"}}</script><style>.hero {
    height: auto;
    margin-top: 200px;
  }
.hero__content {
    position: initial;
    transform: none;
}</style></head><body><div class="site-container"><header class="top" id="js-header"><a class="logo" href="https://lecaro.me/">Renan LE CARO</a><nav class="navbar js-navbar"><ul class="navbar__menu"><li><a href="https://lecaro.me/hi-im-renan.html" target="_self">About</a></li><li><a href="https://lecaro.me/" target="_self">Posts</a></li></ul></nav></header><main><article class="post"><div class="hero"><header class="hero__content"><div class="wrapper"><div class="post__meta"><time datetime="2022-01-10T23:27">January 10, 2022</time></div><h1>Picnic: end-to-end encrypted collaborative text editor</h1></div></header></div><div class="wrapper post__entry"><p>I felt like having a small break from <a href="https://ciboulette.net/">my main project</a> this month, so I'm giving myself <strong>some weeks to try out other ideas</strong> I've been putting off. Just happy coding of open source MVPs for various ideas I've had for a while. I'm giving myself a <strong>max of 7 days per app</strong> to make sure the scope stays reasonable.</p><p>The first one is pretty close to done now, and it's called <a href="https://picnic.lecaro.me/">picnic</a>.</p><p>It's a simple web app that lets you <strong>create a plain text document and edit it with friends in real time</strong> (on PC and smartphone).</p><p>It's <strong>end-to-end encrypted</strong>, so the client side does the encryption with window.crypto (despite not really adding much security) and sends that to my node server over web sockets. The server saves that document and forwards it to the other clients that can decode it thanks to the key stored in the URL. "<strong>Rolling your own crypto</strong>" is generally a bad idea, but I think here i'm "using pre-made crypto" which is alright, despite a very strong feeling on "I have no idea what I'm doing".</p><p>Speaking of haphazardly reaching a decent solution <strong>: syncing edits is hard</strong>. When you type some words in the text, the full value of that text is sent over to the server, who forwards it to everyone as-is. So <strong>each client receives the latest version</strong>, but might have done its own edits that are not yet sent for syncing (two people typing at the same time).</p><p>I end up doing a <strong>three-way merge of full text</strong>, using a homemade, quite naive approach. It works  most of the time, though it quite easily gets confused. Initially, just typing alone on the document would get super messy when the updates from the server would conflict with your local edits.</p><p>My 3 way merge algorithm <strong>performs well when the edits are far from each other</strong>, but it <strong>performs terribly when two users are adding a thing at the same spot</strong> in the doc. Luckily, this only really happen when a user tries to apply his own edits. So I just made the editor ignore any edits that came from itself (using a session ID that only lasts for the duration of the web page). </p><p>Furthermore, some <strong>edits would</strong> <strong>arrive in the wrong order</strong>, and my algorithm would consider a <strong>reversed addition as a deletion</strong>. I could solve that quite easily too, by just <strong>adding a version number to each document</strong>, incrementing it at each edit, and ignoring stale edits. The server keeps the authoritative value for the current version number and blocks any stale edit form propagating. </p><p>Finally, the app <strong>reconnects</strong> with exponential back-off and <strong>retries</strong> to send user's edits whenever the sync fails for any reason, until it's up-to-date with the server. Overall, I'm <strong>quite pleased with the result</strong>, it's usable, loads fast and more reliable than <a href="https://txt.lecaro.me/">my previous attempt</a> at solving the same project. It's also quite easy to self-host as the DB is simply the local file system.</p><p> </p></div></article></main><footer class="footer"><div class="footer__copyright"><p>+33 6 28 35 01 14 (Whatsapp only)</p><p><a href="mailto:renan.lecaro@gmail.com">renan.lecaro@gmail.com</a></p></div></footer></div></body></html>